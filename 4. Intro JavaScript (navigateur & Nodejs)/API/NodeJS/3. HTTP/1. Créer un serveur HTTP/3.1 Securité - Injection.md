# Injection

Soit le serveur HTTP suivant :

```js
import http from "http";
import fs from "fs/promises";

const server = http.createServer(async (req,res)=>{
    // ex : public/index.html
    // ex : public/admin/dashboard.html
    const pathFile = "public"+ (req.url == "/"? "/index.html" : req.url);
    console.log(pathFile);
    fs.readFile(pathFile).then(body=>{
        
        res.write(body);
    }).catch(error=>{
        console.log(error);

        res.statusCode = 404;

        res.write("Erreur : Fichier inconnu\n");
    }).finally(()=>{
        res.end();
    })

});

server.addListener("connection",(socket)=>{
    
    console.log(`Connection detect√© ! `,socket.remoteAddress);
})

server.listen(3000,()=>{
    console.log("Server listen on http://0.0.0.0:3000");
});
``` 

Ce serveur HTTP fournit un fichier donn√©es via l'URL. Les fichiers se trouvent dans un dossier nomm√© public. Si jamais le fichier n'existe pas, une erreur est relev√©e et un statut code 404 est envoy√© au client.

Petit bonus, le serveur est √©galement capable d'√©couter l'√©v√©nement connexion. Ce qui lui permet de r√©cup√©rer directement le socket TCP qui fait fonctionner le client. J'affiche donc son adresse IP.

C'est tr√®s pratique parce que vous allez voir que pour effectuer une injection et donc hacker notre serveur, il va falloir coder le client http pirate √† la main √† partir d'un socket TCP (la couche du dessous).

Je peux faire √ßa en C ou meme avec nodejs et 'api Net.

## Qu'est ce qu'une Injection ?

Sachez que notre serveur a une faille de s√©curit√©.

√âtant donn√© que readFile et l'URL de la requ√™te sont directement concat√©n√©s, il est possible pour l'utilisateur de pr√©ciser une URL en pr√©cisant des `../../` Et ainsi acc√©der aux autres fichiers de votre ordinateur. 

C'est ce que l'on appelle une injection.

L'injection se produit quand un input utilisateur est directement concatt√© dans un interpr√©teur c√¥t√© serveur. Ici, l'interpr√©teur Bash pour la commande readFile.

je devrais donc pouvoir acc√©der √† des fichiers qui se trouvent en dehors de public, en notant la bonne url comme ceci. 

```bash
curl --verbose localhost:3000/../app.mjs
```

Cependant, par s√©curit√©, CURL clean notre URL pour enlever les `..`. Il est donc n√©cessaire de coder le client en langage C l√† o√π aucune limite ne nous sont impos√©es.

## Coder le client pirate Nodejs

Injection dans un serveur HTTP

Voici un r√©po qui montre une faille de s√©curit√© dans un serveur http et comment l'√©viter.

Il y a un client TCP "pirate" dans le r√©po pour faire l'injection par ce que curl et fetch nous emp√™che de faire cette attaque.

Pour ce qui veulent voir comment faire un socket TCP en JS üòâ
Le plus important c'est de bien retenir la r√®gle du Least Privileges (donner le moins de droits possibles au programmes et au utilisateurs pour pr√©venir les failles inconnues de nos logiciels.) 

https://github.com/CHAOUCHI/injection-readFile-http-server/tree/master 

1. Codez un client pirate en C avec l'api Socket ou en JS avec l'api Net de nodejs. Votre aobjetif est de pouvoir r√©cup√©rer le code source du serveur http comme je le fais dans l'exemple du r√©po.